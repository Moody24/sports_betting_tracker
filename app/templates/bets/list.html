{% extends "base.html" %}
{% from "_macros.html" import outcome_badge %}

{% block title %}Bets Â· Sports Betting Tracker{% endblock %}
{% block page_title %}Bets{% endblock %}
{% block page_subtitle %}Filter and review all your wagers in one clean table.{% endblock %}

{% block content %}
<div class="card-soft p-3 mb-4 filter-row">
  <form method="GET" class="row g-2 align-items-end">
    <div class="col-sm-6 col-lg-2">
      <label class="form-label">Sport</label>
      <select class="form-select" name="sport">
        <option value="all" selected>All Sports</option>
      </select>
    </div>
    <div class="col-sm-6 col-lg-2">
      <label class="form-label">Status</label>
      <select class="form-select" name="status">
        <option value="" {% if not filters.status %}selected{% endif %}>All</option>
        <option value="win" {% if filters.status == 'win' %}selected{% endif %}>Win</option>
        <option value="lose" {% if filters.status == 'lose' %}selected{% endif %}>Loss</option>
        <option value="pending" {% if filters.status == 'pending' %}selected{% endif %}>Pending</option>
      </select>
    </div>
    <div class="col-sm-6 col-lg-2">
      <label class="form-label">From</label>
      <input type="date" class="form-control" name="start_date" value="{{ filters.start_date }}">
    </div>
    <div class="col-sm-6 col-lg-2">
      <label class="form-label">To</label>
      <input type="date" class="form-control" name="end_date" value="{{ filters.end_date }}">
    </div>
    <div class="col-lg-3">
      <label class="form-label">Search</label>
      <input type="search" class="form-control" name="q" value="{{ filters.q }}" placeholder="Team name or matchup">
    </div>
    <div class="col-lg-1 d-grid">
      <button class="btn btn-primary" type="submit">Apply</button>
    </div>
  </form>
</div>

<div class="card-soft p-3">
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h3 class="h6 mb-0">All Bets</h3>
    <a href="{{ url_for('bet.new_bet') }}" class="btn btn-primary btn-sm"><i class="bi bi-plus-lg me-1"></i>Add Bet</a>
  </div>

  <div class="table-wrap">
    <table class="table table-dark table-hover align-middle mb-0">
      <thead>
        <tr>
          <th>Matchup</th>
          <th>Date</th>
          <th class="text-end">Stake</th>
          <th>Status</th>
          <th class="text-end">P/L</th>
          <th class="text-end">Actions</th>
        </tr>
      </thead>
      <tbody>
        {% for bet in bets %}
        <tr>
          <td class="fw-semibold">{{ bet.team_a }} <span class="text-secondary">vs</span> {{ bet.team_b }}</td>
          <td>{{ bet.match_date.strftime('%Y-%m-%d') }}</td>
          <td class="text-end">${{ '%.2f'|format(bet.bet_amount) }}</td>
          <td>{{ outcome_badge(bet.outcome) }}</td>
          <td class="text-end {{ 'text-success' if bet.profit_loss() >= 0 else 'text-danger' }}">${{ '%.2f'|format(bet.profit_loss()) }}</td>
          <td class="text-end">
            <form action="{{ url_for('bet.delete_bet', bet_id=bet.id) }}" method="POST" class="d-inline">
              <button type="submit" class="btn btn-sm btn-outline-danger" aria-label="Delete bet {{ bet.id }}">
                <i class="bi bi-trash"></i>
              </button>
            </form>
          </td>
        </tr>
        {% else %}
        <tr>
          <td colspan="6" class="text-center py-4 text-secondary">No bets found for selected filters.</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>
{% endblock %}
